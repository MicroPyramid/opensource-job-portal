{% extends 'dashboard/base.html' %}
{% load page_tags %}

{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a href="{% url 'dashboard:job_posts' job_post.job_type %}" class="inline-flex items-center justify-center w-10 h-10 rounded-lg bg-neutral-100 text-neutral-600 hover:bg-neutral-200 transition-colors">
        <i class="fa fa-arrow-left"></i>
      </a>
      <div>
        <h1 class="text-2xl font-semibold text-neutral-900">Edit Job Post</h1>
        <p class="text-sm text-neutral-500 mt-0.5">{{ job_post.job_type|title }} Job</p>
      </div>
    </div>
  </div>

  <!-- Error Display -->
  <div class="bg-red-50 border border-red-200 rounded-lg p-4 hidden" id="errors_display">
    <div class="flex items-start gap-3">
      <i class="fa fa-times-circle text-red-500 mt-0.5"></i>
      <div>
        <span id="error_count" class="font-medium text-red-800"></span>
        <p class="text-red-700 text-sm mt-1">Please correct the information as per instructions provided and re-submit</p>
      </div>
    </div>
  </div>

  <form id="jobform" name="jobform" method="post" class="space-y-6">
    <!-- Job Details Section -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
        <h3 class="text-lg font-semibold text-neutral-800">
          <i class="fa fa-briefcase text-primary-500 mr-2"></i>Job Details
        </h3>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="title" class="block text-sm font-medium text-neutral-700 mb-2">Job Title <span class="text-red-500">*</span></label>
            <input type="text" class="form-control" placeholder="Enter complete title" name="title" id="title" value="{{ job_post.title }}">
          </div>
          <div>
            <label for="location" class="block text-sm font-medium text-neutral-700 mb-2">Job Location <span class="text-red-500">*</span></label>
            <select class="form-control select2" multiple name="location" id="location">
              <option>Job Location</option>
              {% for city in cities %}
              <option value="{{ city.id }}" {% if city in job_post.location.all %} selected {% endif %} {% ifnotequal country.id job_post.country.id %} disabled {% endifnotequal %}>{{city.name}}</option>
              {% endfor %}
              <option value="other_location">Other Location</option>
            </select>
          </div>
          <div>
            <label for="job_role" class="block text-sm font-medium text-neutral-700 mb-2">Job Role</label>
            <input type="text" class="form-control" placeholder="Job Role" name="job_role" id="job_role" value="{{ job_post.job_role }}">
          </div>
          <div>
            <label for="pincode" class="block text-sm font-medium text-neutral-700 mb-2">Pincode</label>
            <input type="text" class="form-control" placeholder="Pincode" name="pincode" id="pincode" value="{{ job_post.pincode|default_if_none:'' }}">
          </div>
          <div>
            <label for="industry" class="block text-sm font-medium text-neutral-700 mb-2">Industry</label>
            <select class="form-control select2" multiple name="industry" id="industry">
              <option value="">Select Industry</option>
              {% for industry in industries %}
              <option value="{{industry.id}}" {% if industry in job_post.industry.all %} selected {% endif %}>{{industry.name}}</option>
              {% endfor %}
              <option value="other_industry">Other Industry</option>
            </select>
          </div>
          <div>
            <label for="vacancies" class="block text-sm font-medium text-neutral-700 mb-2">Number of Vacancies</label>
            <input type="number" class="form-control" placeholder="Vacancies" name="vacancies" id="vacancies" value="{% if job_post.vacancies > 0%}{{ job_post.vacancies }}{% endif %}">
          </div>
          <div class="md:col-span-2">
            <label for="functional_area" class="block text-sm font-medium text-neutral-700 mb-2">Functional Area</label>
            <select class="form-control select2" multiple name="functional_area" id="functional_area">
              <option value="">Select Functional Area</option>
              {% for fa in functional_area %}
              <option value="{{ fa.id }}" {% if fa in job_post.functional_area.all %} selected {% endif %}>{{ fa.name }}</option>
              {% endfor %}
              <option value="other_functional_area">Other Functional Area</option>
            </select>
          </div>
        </div>

        <div class="mt-6">
          <label for="textareacontents" class="block text-sm font-medium text-neutral-700 mb-2">Job Description <span class="text-red-500">*</span></label>
          <textarea class="form-control" name="textareacontents" id="textareacontents" rows="6" placeholder="Description">{{ job_post.description }}</textarea>
          <input type="hidden" name="description" id="description" value="{{ job_post.description }}">
        </div>

        <div class="mt-6">
          <label for="keywords" class="block text-sm font-medium text-neutral-700 mb-2">Keywords</label>
          <input type="text" class="form-control" placeholder="Special Qualifications, Certifications, Professional Skills etc" name="keywords" id="keywords" value="{% for keyword in job_post.keywords.all %}{{ keyword.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">
        </div>
      </div>
    </div>

    <!-- Eligibility Details Section -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
        <h3 class="text-lg font-semibold text-neutral-800">
          <i class="fa fa-filter text-primary-500 mr-2"></i>Eligibility Details
        </h3>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2">Min Experience</label>
            <div class="grid grid-cols-2 gap-3">
              <select class="form-control" name="min_year" id="min_year">
                <option value="">Years</option>
                {% for year in years %}
                <option value="{{ year.0 }}" id="{{ forloop.counter }}" {% if job_post.min_year|slugify == year.0 %} selected {% endif %}>{{ year.1 }}</option>
                {% endfor %}
              </select>
              <select class="form-control" name="min_month" id="min_month">
                <option value="">Months</option>
                {% for month in months %}
                <option value="{{ month.0 }}" id="{{ forloop.counter }}" {% if job_post.min_month|slugify == month.0 %} selected {% endif %}>{{ month.1 }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2">Max Experience</label>
            <div class="grid grid-cols-2 gap-3">
              <select class="form-control" name="max_year" id="max_year">
                <option value="">Years</option>
                {% for year in years %}
                <option value="{{ year.0 }}" id="{{ forloop.counter }}" {% if job_post.max_year|slugify == year.0 %} selected {% endif %}{% if job_post.min_year|change_to_int > year.0|change_to_int %} class="max_experience" {% endif %}>{{ year.1 }}</option>
                {% endfor %}
              </select>
              <select class="form-control" name="max_month" id="max_month">
                <option value="">Months</option>
                {% for month in months %}
                <option value="{{ month.0 }}" id="{{ forloop.counter }}" {% if job_post.max_month|slugify == month.0 %} selected {% endif %}>{{ month.1 }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div>
            <label for="skills" class="block text-sm font-medium text-neutral-700 mb-2">Technical Skills</label>
            <select class="form-control select2" multiple name="skills" id="skills">
              {% for skill in skills %}
              <option value="{{skill.id}}" {% if skill in job_post.skills.all %} selected {% endif %}>{{skill.name}}</option>
              {% endfor %}
              <option value="other_skills">Other Technical Skill</option>
            </select>
            <input type="hidden" name="company_description" id="company_description" value="{{ job_post.company_description }}">
            <input type="hidden" name="job_interview_location" id="job_interview_location">
            <input type="hidden" id="status" name="status">
          </div>
          <div>
            <label for="edu_qualification" class="block text-sm font-medium text-neutral-700 mb-2">Educational Qualification</label>
            <select class="form-control select2" multiple name="edu_qualification" id="edu_qualification">
              <option value="">Select Qualification</option>
              {% for qualification in qualifications %}
              <option value="{{ qualification.id }}" {% if qualification in job_post.edu_qualification.all %} selected {% endif %}>{{ qualification.name }}</option>
              {% endfor %}
              <option value="other_edu_qualification">Other Qualification</option>
            </select>
          </div>
          <div>
            <label for="major_skill" class="block text-sm font-medium text-neutral-700 mb-2">Major Skill {% if job_type != 'government' %}<span class="text-red-500">*</span>{% endif %}</label>
            <select class="form-control select2" name="major_skill" id="major_skill">
              {% for skill in skills %}
              <option value="{{skill.id}}" {% if skill.id == job_post.major_skill.id %} selected {% endif %}>{{skill.name}}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Visa Requirements -->
        <div class="mt-6 pt-6 border-t border-neutral-200">
          <div class="flex items-center mb-4">
            <input type="checkbox" name="visa_required" id="visa_required" value="{% if job_post.visa_required %}True{% else %}False{% endif %}" {% if job_post.visa_required %}checked{% endif %} class="w-4 h-4 text-primary-500 rounded border-neutral-300">
            <label for="visa_required" class="ml-2 text-sm font-medium text-neutral-700">Visa Required?</label>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="visa_country" class="block text-sm font-medium text-neutral-700 mb-2">Visa Country</label>
              <select class="form-control select2" name="visa_country" id="visa_country">
                <option value="">Select Country</option>
                {% for country in countries %}
                <option value="{{country.id}}" {% if country.id == job_post.visa_country.id %} selected {% endif %}>{{country.name}}</option>
                {% endfor %}
              </select>
            </div>
            <div>
              <label for="visa_type" class="block text-sm font-medium text-neutral-700 mb-2">Required Visa Type</label>
              <input type="text" class="form-control" id="visa_type" name="visa_type" placeholder="Required Visa Type" value="{{ job_post.visa_type }}">
            </div>
          </div>
        </div>
      </div>
    </div>

    {% if job_post.job_type == 'walk-in' %}
    <!-- Walk-in Details -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
        <h3 class="text-lg font-semibold text-neutral-800">
          <i class="fa fa-walking text-primary-500 mr-2"></i>Walk-in Details
        </h3>
      </div>
      <div class="p-6">
        <div>
          <label for="ckeditor_walkin_contactinfo" class="block text-sm font-medium text-neutral-700 mb-2">Contact Information</label>
          <textarea class="form-control" id="ckeditor_walkin_contactinfo" name="ckeditor_walkin_contactinfo" rows="4">{{ job_post.walkin_contactinfo }}</textarea>
          <input type="hidden" name="walkin_contactinfo" id="walkin_contactinfo" value="{{ job_post.walkin_contactinfo }}">
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
          <div>
            <label for="walkin_from_date" class="block text-sm font-medium text-neutral-700 mb-2">From Date</label>
            <input type="text" class="form-control" placeholder="From Date" id="walkin_from_date" name="walkin_from_date" value="{{job_post.walkin_from_date|date:'m/d/Y'}}">
          </div>
          <div>
            <label for="walkin_to_date" class="block text-sm font-medium text-neutral-700 mb-2">To Date</label>
            <input type="text" class="form-control" placeholder="To Date" id="walkin_to_date" name="walkin_to_date" value="{{job_post.walkin_to_date|date:'m/d/Y'}}">
          </div>
          <div>
            <label for="walkin_time" class="block text-sm font-medium text-neutral-700 mb-2">Interview Time</label>
            <input id="walkin_time" name="walkin_time" type="text" class="form-control" value="{{job_post.walkin_time}}">
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Company Details Section -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
        <h3 class="text-lg font-semibold text-neutral-800">
          <i class="fa fa-building text-primary-500 mr-2"></i>Company Details
        </h3>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="company hidden">
            <label for="company_name" class="block text-sm font-medium text-neutral-700 mb-2">Company Name</label>
            <input type="text" class="form-control" placeholder="Company Name" name="company_name" id="company_name" value="{{ job_post.company_name }}">
          </div>
          <div class="company hidden">
            <label for="company_website" class="block text-sm font-medium text-neutral-700 mb-2">Company Website</label>
            <input type="text" class="form-control" placeholder="Company Website" name="company_website" id="company_website" value="{{ job_post.company_website }}">
          </div>
          <div>
            <label for="company" class="block text-sm font-medium text-neutral-700 mb-2">Company</label>
            <select class="form-control select2" name="company" id="company">
              <option value="">Select a Company</option>
              {% for company in companies %}
              <option value="{{company.id}}" {% if company.id == job_post.company.id %} selected {% endif %}>{{company.name}}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label for="company_emails" class="block text-sm font-medium text-neutral-700 mb-2">Company Email</label>
            <input type="email" name="company_emails" id="company_emails" placeholder="Company Email" value="{{ job_post.company_emails|default_if_none:'' }}" class="form-control">
          </div>
        </div>
        <div class="mt-6 company hidden">
          <label for="company_address" class="block text-sm font-medium text-neutral-700 mb-2">Company Address</label>
          <textarea class="form-control" name="company_address" id="company_address" rows="3" placeholder="Company Address">{{ job_post.company_address }}</textarea>
        </div>
        <div class="mt-6 company hidden">
          <label for="contents" class="block text-sm font-medium text-neutral-700 mb-2">About Company</label>
          <textarea class="form-control" name="contents" id="contents" rows="4" placeholder="Description">{{ job_post.company_description }}</textarea>
        </div>
        <div class="mt-6">
          <label for="company_links" class="block text-sm font-medium text-neutral-700 mb-2">Company Links</label>
          <textarea class="form-control" name="company_links" id="company_links" rows="2" placeholder="Company Links">{{ job_post.company_links }}</textarea>
        </div>

        {% if job_post.job_type == 'government' %}
        <div class="mt-6 pt-6 border-t border-neutral-200">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="application_fee" class="block text-sm font-medium text-neutral-700 mb-2">Application Fee</label>
              <input type="text" class="form-control" placeholder="Application Fee" name="application_fee" id="application_fee" value="{{ job_post.application_fee }}">
            </div>
            <div>
              <label for="govt_job_type" class="block text-sm font-medium text-neutral-700 mb-2">Govt Job Type</label>
              <select class="form-control" name="govt_job_type" id="govt_job_type">
                <option value="">Select a Type</option>
                {% for type in gov_job_type %}
                <option value="{{type.0}}" {% if type.0 == job_post.govt_job_type %} selected {% endif %}>{{type.1}}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="mt-6">
            <label for="ckeditor_selection_process" class="block text-sm font-medium text-neutral-700 mb-2">Selection Process</label>
            <textarea class="form-control" name="ckeditor_selection_process" id="ckeditor_selection_process" rows="4" placeholder="Selection Process">{{ job_post.selection_process }}</textarea>
            <input type="hidden" name="selection_process" id="selection_process" value="{{ job_post.selection_process }}">
          </div>
          <div class="mt-6">
            <label for="ckeditor_how_to_apply" class="block text-sm font-medium text-neutral-700 mb-2">How to Apply</label>
            <textarea class="form-control" name="ckeditor_how_to_apply" id="ckeditor_how_to_apply" rows="4" placeholder="How to apply">{{ job_post.how_to_apply }}</textarea>
            <input type="hidden" name="how_to_apply" id="how_to_apply" value="{{ job_post.how_to_apply }}">
          </div>
          <div class="mt-6">
            <label for="ckeditor_important_dates" class="block text-sm font-medium text-neutral-700 mb-2">Important Dates</label>
            <textarea class="form-control" name="ckeditor_important_dates" id="ckeditor_important_dates" rows="4" placeholder="Important Dates">{{ job_post.important_dates }}</textarea>
            <input type="hidden" name="important_dates" id="important_dates" value="{{ job_post.important_dates }}">
          </div>
          <div class="mt-6">
            <label for="ckeditor_age_relaxation" class="block text-sm font-medium text-neutral-700 mb-2">Age Relaxation</label>
            <textarea class="form-control" name="ckeditor_age_relaxation" id="ckeditor_age_relaxation" rows="4" placeholder="Age Relaxation">{{ job_post.age_relaxation }}</textarea>
            <input type="hidden" name="age_relaxation" id="age_relaxation" value="{{ job_post.age_relaxation }}">
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Interview Location Section -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
        <h3 class="text-lg font-semibold text-neutral-800">
          <i class="fa fa-map-marker-alt text-primary-500 mr-2"></i>Interview Location
        </h3>
      </div>
      <div class="p-6">
        {% for location in job_post.job_interview_location.all %}
        <div class="another_location mb-4 p-4 bg-neutral-50 rounded-lg relative">
          <button type="button" class="delete-interview absolute top-2 right-2 w-8 h-8 rounded-lg text-neutral-500 hover:bg-red-50 hover:text-red-600 transition-colors" id="interview_location_{{ forloop.counter }}">
            <i class="fa fa-trash"></i>
          </button>
          <div id="interview_location_{{ forloop.counter }}" class="interview_location">
            <div class="location_{{ forloop.counter }}" style="display:none">{{ location.get_map_coordinates_list|safe }}</div>
            <div>
              <label for="venue_details_{{ forloop.counter }}" class="block text-sm font-medium text-neutral-700 mb-2">Venue Details {{ forloop.counter }}</label>
              <textarea name="venue_details_{{ forloop.counter }}" id="venue_details_{{ forloop.counter }}" class="form-control interview_location_venue_details_{{ forloop.counter }}" rows="3" placeholder="Company Address">{{ location.venue_details }}</textarea>
              <textarea class="hidden" name="final_location_{{ forloop.counter }}" id="final_location_{{ forloop.counter }}" class="final_location_{{ forloop.counter }}">{{ location.get_coordinates_list }}</textarea>
            </div>
          </div>
        </div>
        {% endfor %}
        <button type="button" class="inline-flex items-center gap-2 px-4 py-2 bg-primary-50 text-primary-700 rounded-lg hover:bg-primary-100 transition-colors" id="another_location">
          <i class="fa fa-plus"></i>Another Location
        </button>
      </div>
    </div>

    <!-- Offering Details Section -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
        <h3 class="text-lg font-semibold text-neutral-800">
          <i class="fa fa-money-bill text-primary-500 mr-2"></i>Offering Details
        </h3>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label for="salary_type" class="block text-sm font-medium text-neutral-700 mb-2">Salary Type</label>
            <select class="form-control" name="salary_type" id="salary_type">
              <option value="">Select Salary Type</option>
              <option value="Month" {% if job_post.salary_type == 'Month' %}selected{% endif %}>Per Month</option>
              <option value="Year" {% if job_post.salary_type == 'Year' %}selected{% endif %}>Per Year</option>
            </select>
            <input type="hidden" id="published_message" name="published_message" value="{{ job_post.published_message }}">
            <input type="hidden" id="location_name" name="location_name" value="location_0">
            <input type="hidden" id="searchbox_name" name="searchbox_name" value="search_0">
            <input type="hidden" id="job_type" name="job_type" value="{{ job_post.job_type }}">
          </div>
          <div>
            <label for="min_salary" class="block text-sm font-medium text-neutral-700 mb-2">Min Salary</label>
            <input type="text" class="form-control" placeholder="Minimum Salary" id="min_salary" name="min_salary" value="{{ job_post.min_salary }}">
          </div>
          <div>
            <label for="max_salary" class="block text-sm font-medium text-neutral-700 mb-2">Max Salary</label>
            <input type="text" class="form-control" placeholder="Maximum Salary" id="max_salary" name="max_salary" value="{{ job_post.max_salary }}">
          </div>
        </div>
      </div>
    </div>

    <!-- Post Validity Section -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 border-b border-neutral-200 bg-neutral-50">
        <h3 class="text-lg font-semibold text-neutral-800">
          <i class="fa fa-calendar text-primary-500 mr-2"></i>Post Validity & Deadline
        </h3>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {% if job_post.job_type == 'government' %}
          <div>
            <label for="govt_from_date" class="block text-sm font-medium text-neutral-700 mb-2">From Date</label>
            <input type="text" class="form-control" placeholder="From Date" id="govt_from_date" name="govt_from_date" value="{{job_post.govt_from_date|date:'m/d/Y'}}">
          </div>
          <div>
            <label for="govt_to_date" class="block text-sm font-medium text-neutral-700 mb-2">To Date</label>
            <input type="text" class="form-control" placeholder="To Date" id="govt_to_date" name="govt_to_date" value="{{job_post.govt_to_date|date:'m/d/Y'}}">
          </div>
          <div>
            <label for="govt_exam_date" class="block text-sm font-medium text-neutral-700 mb-2">Exam Date</label>
            <input type="text" class="form-control" placeholder="Exam Date" id="govt_exam_date" name="govt_exam_date" value="{{job_post.govt_exam_date|date:'m/d/Y'}}">
          </div>
          {% endif %}
          <div>
            <label for="published_date" class="block text-sm font-medium text-neutral-700 mb-2">Published On</label>
            <input type="text" class="form-control" placeholder="Published Date" id="published_date" name="published_date" value="{{job_post.published_date|date:'m/d/Y H:i:s'}}">
            <input type="hidden" id="no_of_interview_location" name="no_of_interview_location">
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
      <div class="px-6 py-4 flex flex-wrap items-center gap-3">
        <button type="button" class="btn btn-primary" id="publish">
          <i class="fa fa-check mr-2"></i>Post Job
        </button>
        <button type="button" class="btn btn-secondary" id="preview">
          <i class="fa fa-eye mr-2"></i>Save & Preview
        </button>
        <button type="button" class="btn btn-secondary cancel_btn" id="cancel_btn">
          <i class="fa fa-times mr-2"></i>Cancel
        </button>
      </div>
    </div>

    <!-- Social Post -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm p-6">
      <div class="flex items-center gap-4">
      </div>
    </div>
  </form>
</div>

<!-- Dialog Form -->
<div id="dialog-form" class="hidden">
  <form>
    <label for="enter_message" class="block text-sm font-medium text-neutral-700 mb-2">Message</label>
    <input type="text" name="message" id="enter_message" class="form-control">
  </form>
</div>

<style>
.company { display: none; }
.max_experience { display: none; }
</style>
{% endblock %}

{% block script %}
<script type="text/javascript">
  function other_fields(form_data) {
    industry = []
    functional_area = []
    edu_qualification = []
    skills = []
    interview_location = []
    venue_details = []
    interview_location_count = $('div.interview_location').length

    jQuery.each(form_data, function (i, field) {
      if (field['name'].indexOf('other_industry_name') >= 0) {
        industry_temp = {}
        industry_temp[field['name']] = field['value']
        industry.push(industry_temp)
      }
      if (field['name'].indexOf('interview_city') >= 0) {
        interview_temp = {}
        interview_temp[field['name']] = field['value']
        interview_location.push(interview_temp)
      }
      if (field['name'].indexOf('venue_details') >= 0) {
        interview_temp = {}
        interview_temp[field['name']] = field['value']
        venue_details.push(interview_temp)
      }
      if (field['name'].indexOf('other_functional_area') >= 0) {
        functional_area_temp = {}
        functional_area_temp[field['name']] = field['value']
        functional_area.push(functional_area_temp)
      }
      if (field['name'].indexOf('other_edu_qualification') >= 0) {
        edu_qualification_temp = {}
        edu_qualification_temp[field['name']] = field['value']
        edu_qualification.push(edu_qualification_temp)
      }
      if (field['name'].indexOf('other_skill_name') >= 0) {
        skills_temp = {}
        skills_temp[field['name']] = field['value']
        skills.push(skills_temp)
      }
    });

    $("#jobform").append('<textarea class="form-control other_functional_area hidden" name="final_functional_area" id="final_functional_area">' + JSON.stringify(functional_area) + '</textarea>');
    $("#jobform").append('<textarea class="form-control other_functional_area hidden" name="final_skills" id="final_skills">' + JSON.stringify(skills) + '</textarea>');
    $("#jobform").append('<textarea class="form-control other_functional_area hidden" name="final_edu_qualification" id="final_edu_qualification">' + JSON.stringify(edu_qualification) + '</textarea>');
    $("#jobform").append('<textarea class="form-control other_functional_area hidden" name="final_industry" id="final_industry">' + JSON.stringify(industry) + '</textarea>');
    $("#jobform").append('<textarea class="form-control other_functional_area hidden" name="final_interview_location" id="final_interview_location">' + JSON.stringify(interview_location) + '</textarea>');
    $("#jobform").append('<textarea class="form-control other_functional_area hidden" name="final_venue_details" id="final_venue_details">' + JSON.stringify(venue_details) + '</textarea>');
    $('#no_of_interview_location').val(interview_location_count)
  }

  $(".select2").select2({ tags: true })

  $("#published_date").datetimepicker({ format: "MM/DD/YYYY HH:mm:ss" });

  $("body").on("click", ".remove_other_field", function (e) {
    e.preventDefault();
    $(this).parent().remove();
  });

  $("body").on("click", "#another_location", function (e) {
    last_interview_location = $('div.interview_location').length
    var selected_interview_location = []
    $('.interview_city').each(function () {
      selected_interview_location.push($(this).val())
    })
    $.post('/recruiter/job/interview-location/' + last_interview_location + '/', {'selected_locations': JSON.stringify(selected_interview_location)}, function (data) {
      $("#another_location").before(data);
    });
    location_count = last_interview_location + 1
    location_name = 'location_' + location_count
    searchbox_name = 'search_' + location_count
    $('#location_name').val(location_name)
    $('#searchbox_name').val(searchbox_name)
  });

  $("body").on("click", "span.delete-interview, button.delete-interview", function (e) {
    id = $(this).attr('id')
    if ($('.interview_location').length > 1) {
      $('div#' + id).parent().remove();
    } else {
      open_dialog('Job Post Should Contain At Least One Interview Location', 'Error!!')
    }
  });

  $("body").on("change", "select#industry", function (e) {
    e.preventDefault();
    if (jQuery.inArray("other_industry", $("select#industry").val()) >= 0) {
      new_data = $.grep($('select#industry').select2('val'), function (val) { return val != 'other_industry'; });
      $("select#industry").select2('val', new_data);
      industry_count = $('.other_industry_name').length + 1
      $("select#industry").siblings('span').after('<div class="extra mt-2"><input type="text" class="form-control other_industry_name" placeholder="Other Industry Name" name="other_industry_name_' + industry_count + '" id="other_industry_name_' + industry_count + '"><a href="#" class="remove_other_field text-red-500 ml-2"><i class="fa fa-times"></i></a></div>')
    }
  });

  $("select#skills").on("select2:select", function (evt) {
    var element = evt.params.data.element;
    var $element = $(element);
    $element.detach();
    $(this).append($element);
    $(this).trigger("change");
  });

  $("body").on("change", "select#skills", function (e) {
    e.preventDefault();
    if (jQuery.inArray("other_skills", $("select#skills").val()) >= 0) {
      new_data = $.grep($('select#skills').select2('val'), function (val) { return val != 'other_skills'; });
      $("select#skills").select2('val', new_data);
      industry_count = $('.other_skill_name').length + 1
      $("select#skills").siblings('span').after('<div class="extra mt-2"><input type="text" class="form-control other_skill_name" placeholder="Other Skill Name" name="other_skill_name_' + industry_count + '" id="other_skill_name_' + industry_count + '"><a href="#" class="remove_other_field text-red-500 ml-2"><i class="fa fa-times"></i></a></div>')
    }
  });

  $("select#functional_area").on('change', function (e) {
    e.preventDefault();
    if (jQuery.inArray("other_functional_area", $("select#functional_area").val()) >= 0) {
      new_data = $.grep($('select#functional_area').select2('val'), function (val) { return val != 'other_functional_area'; });
      $("select#functional_area").select2('val', new_data);
      functional_area_count = $('.other_functional_area').length + 1
      $("select#functional_area").siblings('span').after('<div class="extra mt-2"><input type="text" class="form-control other_functional_area" placeholder="Other Functional Area Name" name="other_functional_area_' + functional_area_count + '" id="other_functional_area_' + functional_area_count + '"><a href="#" class="remove_other_field text-red-500 ml-2"><i class="fa fa-times"></i></a></div>')
    }
  });

  $("select#edu_qualification").on('change', function (e) {
    if (jQuery.inArray("other_edu_qualification", $("select#edu_qualification").val()) >= 0) {
      new_data = $.grep($('select#edu_qualification').select2('val'), function (val) { return val != 'other_edu_qualification'; });
      $("select#edu_qualification").select2('val', new_data);
      edu_qualification_count = $('.other_edu_qualification').length + 1
      $("select#edu_qualification").siblings('span').after('<div class="extra mt-2"><input type="text" class="form-control other_edu_qualification" placeholder="Other Qualification Name" name="other_edu_qualification_' + edu_qualification_count + '" id="other_edu_qualification_' + edu_qualification_count + '"><a href="#" class="remove_other_field text-red-500 ml-2"><i class="fa fa-times"></i></a></div>')
    }
  });

  $("select.select2").select2({ placeholder: "Select here" });

  $("select#min_year").on('change', function (e) {
    $('select#max_year').val('');
    $('select#max_year option').addClass('max_experience');
    for (i = $('select#min_year option:selected').attr('id'); i < $('select#min_year option').length; i++) {
      $('select#max_year option[id=' + i + ']').removeClass('max_experience');
    }
  });

  $("select#min_month").on('change', function (e) {
    $('select#max_month').val('');
    if ($('select#max_year').val() == $('select#min_year').val()) {
      $('select#max_month option').addClass('max_experience');
      for (i = $('select#min_month option:selected').attr('id'); i < $('select#min_month option').length; i++) {
        $('select#max_month option[id=' + i + ']').removeClass('max_experience');
      }
    } else {
      $('select#max_month option').removeClass('max_experience');
    }
  });

  $("select#max_year").on('change', function (e) {
    $('select#max_month').val('');
    if ($('select#max_year').val() == $('select#min_year').val()) {
      $('select#max_month option').addClass('max_experience');
      for (i = $('select#min_month option:selected').attr('id'); i < $('select#min_month option').length; i++) {
        $('select#max_month option[id=' + i + ']').removeClass('max_experience');
      }
    } else {
      $('select#max_month option').removeClass('max_experience');
    }
  });

  $('#visa_required').click(function () {
    if (document.getElementById('visa_required').checked) {
      $("#visa_country").prop("disabled", false);
      $("#visa_type").prop("disabled", false);
    } else {
      $("select#visa_country").select2("val", "");
      $("#visa_type").val('');
      $("#visa_country").prop("disabled", true);
      $("#visa_type").prop("disabled", true);
    }
  });

  $(document).ready(function (e) {
    CKEDITOR.config.allowedContent = true;
    var editor = CKEDITOR.replace('textareacontents', {});
    {% if job_post.job_type == 'walk-in' %}
    var editor = CKEDITOR.replace('ckeditor_walkin_contactinfo', {});
    {% endif %}
    {% if job_post.job_type == 'government' %}
    var editor = CKEDITOR.replace('ckeditor_selection_process', {});
    var editor = CKEDITOR.replace('ckeditor_age_relaxation', {});
    var editor = CKEDITOR.replace('ckeditor_how_to_apply', {});
    var editor = CKEDITOR.replace('ckeditor_important_dates', {});
    var editor = CKEDITOR.replace('contents', {});
    {% endif %}
  });

  $("#preview").click(function (e) {
    e.preventDefault();
    $('#status').val('Draft');
    form_data = $('#jobform').serializeArray();
    other_fields(form_data)
    $("input[name='description']").val(CKEDITOR.instances.textareacontents.getData());
    {% if job_type == 'walk-in' %}
    $("input[name='walkin_contactinfo']").val(CKEDITOR.instances.ckeditor_walkin_contactinfo.getData());
    {% endif %}
    {% if job_post.job_type == 'government' %}
    $("input[name='company_description']").val(CKEDITOR.instances.contents.getData());
    $("input[name='important_dates']").val(CKEDITOR.instances.ckeditor_important_dates.getData());
    $("input[name='how_to_apply']").val(CKEDITOR.instances.ckeditor_how_to_apply.getData());
    $("input[name='selection_process']").val(CKEDITOR.instances.ckeditor_selection_process.getData());
    $("input[name='age_relaxation']").val(CKEDITOR.instances.ckeditor_age_relaxation.getData());
    {% endif %}
    $.post('.', $("form#jobform").serialize(), function (data) {
      if (data.error) {
        open_dialog('Some Content Missing', 'Error!!')
        $('div.error').remove();
        for (var key in data.response) {
          if ($('#' + key).hasClass('select2')) {
            $('#' + key).parent().after('<div class="error text-red-500 text-sm mt-1">' + data.response[key] + '</div>');
          } else {
            $('#' + key).after('<div class="error text-red-500 text-sm mt-1">' + data.response[key] + '</div>');
          }
        }
      } else {
        open_dialog_with_url('New JobPost Drafted Successfully', 'Success!!!', '/dashboard/jobpost/preview/' + data.post + '/')
      }
    }, 'json');
  });

  $("#publish").click(function (e) {
    e.preventDefault();
    $('#status').val('Pending');
    form_data = $('#jobform').serializeArray();
    other_fields(form_data)
    $('#enter_message').val('')
    $('#dialog-form').dialog({
      modal: true,
      dialogClass: "no-close",
      draggable: false,
      title: "Please enter your message",
      buttons: [
        {
          text: "Yes",
          click: function () {
            $(this).dialog("close");
            if ($('#enter_message').val() == '') {
              $(this).dialog('close')
              open_dialog('Message Cannot Be Empty!', 'Info!')
              return
            }
            $('#published_message').val($('#enter_message').val());
            $("input[name='description']").val(CKEDITOR.instances.textareacontents.getData());
            {% if job_type == 'walk-in' %}
            $("input[name='walkin_contactinfo']").val(CKEDITOR.instances.ckeditor_walkin_contactinfo.getData());
            {% endif %}
            {% if job_post.job_type == 'government' %}
            $("input[name='company_description']").val(CKEDITOR.instances.contents.getData());
            $("input[name='important_dates']").val(CKEDITOR.instances.ckeditor_important_dates.getData());
            $("input[name='how_to_apply']").val(CKEDITOR.instances.ckeditor_how_to_apply.getData());
            $("input[name='selection_process']").val(CKEDITOR.instances.ckeditor_selection_process.getData());
            $("input[name='age_relaxation']").val(CKEDITOR.instances.ckeditor_age_relaxation.getData());
            {% endif %}
            $.post('.', $("form#jobform").serialize(), function (data) {
              if (data.error) {
                open_dialog('Some Content Missing', 'Error!!')
                $('div.error').remove();
                for (var key in data.response) {
                  if ($('#' + key).hasClass('select2')) {
                    $('#' + key).parent().after('<div class="error text-red-500 text-sm mt-1">' + data.response[key] + '</div>');
                  } else {
                    $('#' + key).after('<div class="error text-red-500 text-sm mt-1">' + data.response[key] + '</div>');
                  }
                }
              } else {
                open_dialog_with_url('New JobPost Drafted Successfully', 'Success!!!', "{% url 'dashboard:job_posts' job_post.job_type %}")
              }
            }, 'json');
          }
        },
        {
          text: "No",
          click: function () {
            $(this).dialog("close");
            return;
          }
        }
      ]
    });
  });

  $("#cancel_btn").click(function (e) {
    e.preventDefault();
    window.location = "{% url 'dashboard:job_posts' job_post.job_type %}";
  });

  $('#walkin_time').timepicker();
  $("#walkin_from_date").datepicker({ changeMonth: true, changeYear: true, yearRange: "2015:2050" });
  $("#walkin_to_date").datepicker({ changeMonth: true, changeYear: true, yearRange: "2015:2050" });
  $("#govt_from_date").datepicker({ changeMonth: true, changeYear: true, yearRange: "2015:2050" });
  $("#govt_to_date").datepicker({ changeMonth: true, changeYear: true, yearRange: "2015:2050" });
  $("#govt_exam_date").datepicker({ changeMonth: true, changeYear: true, yearRange: "2015:2050" });
</script>
{% endblock %}
