{% extends 'dashboard/base.html' %}
{% load page_tags %}
{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-neutral-900">Daily Mail Summary</h1>
      <p class="text-sm text-neutral-500 mt-0.5">View mail applicant statistics</p>
    </div>
  </div>

  <!-- Hidden Form -->
  <form id="search_form" name="adv-search-form" method="POST" action="." class="hidden">
    <input type="hidden" name="page" id="page" value="{{ page }}"/>
  </form>

  <!-- Data Table -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full" id="sample_1">
        <thead>
          <tr class="bg-neutral-50 border-b border-neutral-200">
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider w-16">#</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Email</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Mobile</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Created On</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Mail Sent</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">PJ Connected</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-neutral-100">
          {% for each in all_mail_applicants %}
          <tr class="hover:bg-neutral-50 transition-colors">
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-500">{{ forloop.counter }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-900">{{ each.email }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ each.mobile }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ each.date }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {% if each.mail_sent %}bg-green-100 text-green-800{% else %}bg-neutral-100 text-neutral-600{% endif %}">
                {{ each.mail_sent }}
              </span>
            </td>
            <td class="px-4 py-3">
              {% if each.email|is_connected %}
                {% with each.email|is_connected as user %}
                <a href="{% url 'dashboard:view_applicant' user.id %}" class="inline-flex items-center text-sm text-primary-600 hover:text-primary-700">
                  <i class="fa fa-link mr-1"></i>Connected
                </a>
                {% endwith %}
              {% else %}
              <span class="text-sm text-neutral-500">Not Connected</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center">
                <div class="w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mb-4">
                  <i class="fa fa-envelope text-2xl text-neutral-400"></i>
                </div>
                <p class="text-neutral-500">No mail applicants found</p>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  {% if all_mail_applicants %}
  <div class="flex justify-center">
    {% get_page current_page last_page as pages %}
    <nav class="flex items-center gap-1">
      {% if current_page != 1 %}
      <a href="#" class="pagination-link p-2 rounded-lg hover:bg-neutral-100 text-neutral-600 transition-colors" data-page="{{ previous_page }}">
        <i class="fa fa-angle-double-left"></i>
      </a>
      <a href="#" class="pagination-link p-2 rounded-lg hover:bg-neutral-100 text-neutral-600 transition-colors" data-page="{{ prev_page }}">
        <i class="fa fa-angle-left"></i>
      </a>
      <a href="#" class="pagination-link px-3 py-2 rounded-lg hover:bg-neutral-100 text-neutral-600 transition-colors text-sm" data-page="1">first</a>
      {% endif %}
      {% for s in pages %}
      <a href="#" class="pagination-link px-3 py-2 rounded-lg text-sm transition-colors {% if s == current_page %}bg-primary-600 text-white{% else %}hover:bg-neutral-100 text-neutral-600{% endif %}" data-page="{{ s }}">{{ s }}</a>
      {% endfor %}
      {% if current_page != last_page %}
      <a href="#" class="pagination-link px-3 py-2 rounded-lg hover:bg-neutral-100 text-neutral-600 transition-colors text-sm" data-page="{{ last_page }}">last</a>
      <a href="#" class="pagination-link p-2 rounded-lg hover:bg-neutral-100 text-neutral-600 transition-colors" data-page="{{ aft_page }}">
        <i class="fa fa-angle-right"></i>
      </a>
      <a href="#" class="pagination-link p-2 rounded-lg hover:bg-neutral-100 text-neutral-600 transition-colors" data-page="{{ after_page }}">
        <i class="fa fa-angle-double-right"></i>
      </a>
      {% endif %}
    </nav>
  </div>
  {% endif %}
</div>
{% endblock stage %}

{% block script %}
<script type="text/javascript">
$('.pagination-link').click(function(e) {
  e.preventDefault();
  $('#page').val($(this).data('page'));
  $('#search_form').submit();
});
</script>
{% endblock script %}
