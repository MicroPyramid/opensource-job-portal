{% extends 'dashboard/base.html' %}
{% load page_tags %}
{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-neutral-900">Functional Area</h1>
      <p class="text-sm text-neutral-500 mt-0.5">Manage functional area options</p>
    </div>
    <div class="flex items-center gap-2">
      <a href="{% url 'dashboard:functional_area' %}?status=active" class="inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium transition-colors {% if status == 'active' %}bg-primary-500 text-white{% else %}bg-neutral-100 text-neutral-600 hover:bg-neutral-200{% endif %}">
        Active
      </a>
      <a href="{% url 'dashboard:functional_area' %}?status=inactive" class="inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium transition-colors {% if status == 'inactive' %}bg-primary-500 text-white{% else %}bg-neutral-100 text-neutral-600 hover:bg-neutral-200{% endif %}">
        Inactive
      </a>
    </div>
  </div>

  <!-- Add and Search Forms -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Add Form -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm p-4">
      <form id="addform" method="post" action="." class="flex gap-2">
        <input type="text" class="form-control flex-1" id="functional_area_name" placeholder="Enter functional area name">
        <button type="submit" class="btn btn-primary whitespace-nowrap">
          <i class="fa fa-plus mr-2"></i>Add New
        </button>
      </form>
    </div>

    <!-- Search Form -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm p-4">
      <form id="search_form" name="adv-search-form" class="flex gap-2" method="GET">
        <input type="text" name="search" id="search" class="form-control flex-1" placeholder="Enter search value" value="{{ request.GET.search }}">
        <input type="hidden" name="status" id="status" value="{% if request.GET.status %}{{ request.GET.status }}{% endif %}">
        <input type="hidden" name="page" id="page" value="{% if request.GET.page %}{{ request.GET.page }}{% else %}1{% endif %}">
        <button type="submit" class="btn btn-secondary whitespace-nowrap">
          <i class="fa fa-search mr-2"></i>Search
        </button>
      </form>
    </div>
  </div>

  <!-- Functional Area List -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h3 class="text-lg font-semibold text-neutral-800">
        <i class="fa fa-briefcase text-primary-500 mr-2"></i>Functional Areas List
      </h3>
    </div>
    <div class="divide-y divide-neutral-100">
      {% for functional_area in functional_areas %}
      <div class="p-4 hover:bg-neutral-50 transition-colors">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="text-sm font-medium text-neutral-900">{{ functional_area.name }}</span>
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-700">
              {{ functional_area.get_no_of_jobposts|length }} jobs
            </span>
          </div>
          <div class="flex items-center gap-2">
            <button class="edit-btn p-1.5 rounded-md hover:bg-primary-100 text-primary-600 transition-colors" title="Edit">
              <i class="fa-solid fa-pen-to-square"></i>
            </button>
            {% if functional_area.status == 'InActive' %}
            <a href="#" rel="{% if request.GET.page %}{{ request.GET.page }}{% else %}1{% endif %}" id="{{ functional_area.id }}" class="enable-fa p-1.5 rounded-md hover:bg-green-100 text-green-600 transition-colors" title="Activate">
              <i class="fa fa-check"></i>
            </a>
            {% else %}
            <a href="#" id="{{ functional_area.id }}" rel="{% if request.GET.page %}{{ request.GET.page }}{% else %}1{% endif %}" class="deactivate-fa p-1.5 rounded-md hover:bg-yellow-100 text-yellow-600 transition-colors" title="Deactivate">
              <i class="fa fa-times"></i>
            </a>
            {% endif %}
            <a href="{% url 'dashboard:delete_functional_area' functional_area_id=functional_area.id %}" class="p-1.5 rounded-md hover:bg-red-100 text-red-600 transition-colors" title="Delete">
              <i class="fa-solid fa-trash-can"></i>
            </a>
          </div>
        </div>
        <!-- Edit Panel (hidden by default) -->
        <div class="edit_panel hidden mt-4 pt-4 border-t border-neutral-200">
          <form id="editform{{ functional_area.id }}" method="post" action="." class="space-y-3">
            <input type="hidden" name="id" value="{{ functional_area.id }}">
            <input type="hidden" name="mode" value="edit_functional_area">
            <input type="hidden" name="page" value="{% if request.GET.page %}{{ request.GET.page }}{% else %}1{% endif %}">
            <textarea class="form-control w-full" name="name" rows="2">{{ functional_area.name }}</textarea>
            <button type="button" id="{{ functional_area.id }}" class="update_btn btn btn-primary btn-sm">
              <i class="fa fa-check mr-2"></i>Update
            </button>
          </form>
        </div>
      </div>
      {% empty %}
      <div class="p-12 text-center">
        <div class="w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mx-auto mb-4">
          <i class="fa fa-briefcase text-2xl text-neutral-400"></i>
        </div>
        <p class="text-neutral-500">No functional areas found</p>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Pagination -->
  {% if functional_areas %}
  {% get_page current_page last_page as pages %}
  {% if last_page > 1 %}
  <div class="flex justify-center">
    <nav class="inline-flex items-center gap-1">
      {% if current_page != 1 %}
      <a href="?{% if search %}search={{ search }}&{% endif %}{% if status %}status={{ status }}&{% endif %}page={{ previous_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-double-left"></i>
      </a>
      <a href="?{% if search %}search={{ search }}&{% endif %}{% if status %}status={{ status }}&{% endif %}page={{ prev_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-left"></i>
      </a>
      {% endif %}
      {% for s in pages %}
      <a href="?{% if search %}search={{ search }}&{% endif %}{% if status %}status={{ status }}&{% endif %}page={{ s }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border text-sm font-medium transition-colors {% if s == current_page %}border-primary-500 bg-primary-500 text-white{% else %}border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50{% endif %}">
        {{ s }}
      </a>
      {% endfor %}
      {% if current_page != last_page %}
      <a href="?{% if search %}search={{ search }}&{% endif %}{% if status %}status={{ status }}&{% endif %}page={{ aft_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-right"></i>
      </a>
      <a href="?{% if search %}search={{ search }}&{% endif %}{% if status %}status={{ status }}&{% endif %}page={{ after_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-double-right"></i>
      </a>
      {% endif %}
    </nav>
  </div>
  {% endif %}
  {% endif %}
</div>
{% endblock stage %}

{% block script %}
<script type="text/javascript">
$(document).ready(function(event) {
  $('.edit-btn').click(function(e) {
    $(this).closest('.p-4').find('.edit_panel').slideToggle('slow');
  });
});

$("#addform").submit(function(e) {
  e.preventDefault();
  $.post('.', {mode: 'add_functional_area', name: $('#functional_area_name').val()}, function(data) {
    if (data.error == false) {
      open_dialog_with_url(data.message, 'Success!!!', ".")
    } else {
      open_dialog(data.message, 'Info!')
    }
  }, 'json');
});

$(".update_btn").click(function(e) {
  e.preventDefault();
  $.post('.', $("#editform" + $(this).attr('id')).serialize(), function(data) {
    if (data.error == false) {
      open_dialog_with_url(data.message, 'Success!!!', "{% url 'dashboard:functional_area' %}?page=" + data.page)
    } else {
      open_dialog(data.message, 'Error!')
    }
  }, 'json');
});

$('.deactivate-fa').click(function(e) {
  e.preventDefault();
  href = $(this).attr('id') + '/'
  page = $(this).attr("rel")
  $('#block_question').text('Do you want to deactivate Functional Area?')
  $('#block_question').dialog({
    modal: true,
    dialogClass: "no-close",
    draggable: false,
    title: "Info!!",
    buttons: [
      {
        text: "Yes",
        click: function() {
          $(this).dialog("close");
          $.post('/dashboard/functional_area/status/' + href, {"page": page}, function(data) {
            if (data.error) {
              open_dialog(data.response, 'Error!')
            } else {
              open_dialog_with_url('Functional Area Disabled Successfully', 'Success!!!', "{% url 'dashboard:functional_area' %}?page=" + data.page)
            }
          }, 'json');
        }
      },
      {
        text: "No",
        click: function() {
          $(this).dialog("close");
        }
      }
    ]
  });
});

$('.enable-fa').click(function(e) {
  e.preventDefault();
  href = $(this).attr('id') + '/'
  page = $(this).attr("rel")
  $('#block_question').text('Do you want to activate Functional Area?')
  $('#block_question').dialog({
    modal: true,
    dialogClass: "no-close",
    draggable: false,
    title: "Info!!",
    buttons: [
      {
        text: "Yes",
        click: function() {
          $(this).dialog("close");
          $.post('/dashboard/functional_area/status/' + href, {"page": page}, function(data) {
            if (data.error) {
              open_dialog(data.response, 'Error!')
            } else {
              open_dialog_with_url('Functional Area Activated Successfully', 'Success!!!', "{% url 'dashboard:functional_area' %}?page=" + data.page)
            }
          }, 'json');
        }
      },
      {
        text: "No",
        click: function() {
          $(this).dialog("close");
        }
      }
    ]
  });
});
</script>
{% endblock script %}
