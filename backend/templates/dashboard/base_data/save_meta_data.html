{% extends 'dashboard/base.html' %}
{% load thumbnail %}
{% load page_tags %}
{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-neutral-900">Meta Data</h1>
      <p class="text-sm text-neutral-500 mt-0.5">Manage SEO meta data</p>
    </div>
    <button class="btn btn-primary" id="new_meta">
      <i class="fa fa-plus mr-2"></i>Add Meta
    </button>
  </div>

  <!-- Add Meta Form (hidden by default) -->
  <div class="add_panel hidden bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h3 class="text-lg font-semibold text-neutral-800">
        <i class="fa fa-plus text-primary-500 mr-2"></i>Add New Meta Data
      </h3>
    </div>
    <div class="p-6">
      <form class="addform space-y-4" id="addform" method="post" enctype="multipart/form-data">
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-1">Meta Name</label>
          <textarea class="form-control" name="name" id="name" placeholder="Enter meta name" rows="2"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-1">Meta Title</label>
          <textarea class="form-control" name="meta_title" id="meta_title" placeholder="Enter meta title" rows="2"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-1">Meta Description</label>
          <textarea class="form-control" name="meta_description" id="meta_description" placeholder="Enter meta description" rows="3"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-1">H1 Tag Description</label>
          <textarea class="form-control" name="h1_tag" id="h1_tag" placeholder="Enter H1 tag description" rows="2"></textarea>
        </div>
        <input type="hidden" name="mode" value="add_data">
        <button type="submit" class="btn btn-primary">
          <i class="fa fa-check mr-2"></i>Submit
        </button>
      </form>
    </div>
  </div>

  <!-- Meta Data List -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h3 class="text-lg font-semibold text-neutral-800">
        <i class="fa fa-tags text-primary-500 mr-2"></i>Meta Data List
      </h3>
    </div>
    <div class="divide-y divide-neutral-100">
      {% for meta in meta_data %}
      <div class="p-4 hover:bg-neutral-50 transition-colors">
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium text-neutral-900">{{ meta.name }}</span>
          <div class="flex items-center gap-2">
            <button class="edit-btn p-1.5 rounded-md hover:bg-primary-100 text-primary-600 transition-colors" title="Edit">
              <i class="fa fa-pencil-square-o"></i>
            </button>
            <button class="delete_data p-1.5 rounded-md hover:bg-red-100 text-red-600 transition-colors" data-href="{{ meta.id }}" title="Delete">
              <i class="fa fa-trash-o"></i>
            </button>
          </div>
        </div>
        <!-- Edit Panel (hidden by default) -->
        <div class="edit_panel hidden mt-4 pt-4 border-t border-neutral-200">
          <form class="editform space-y-3" method="post" enctype="multipart/form-data">
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-1">Meta Name</label>
              <textarea class="form-control" name="name" rows="2">{{ meta.name }}</textarea>
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-1">Meta Title</label>
              <textarea class="form-control" name="meta_title" rows="2">{{ meta.meta_title }}</textarea>
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-1">Meta Description</label>
              <textarea class="form-control" name="meta_description" rows="3">{{ meta.meta_description }}</textarea>
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-1">H1 Tag Description</label>
              <textarea class="form-control" name="h1_tag" rows="2">{{ meta.h1_tag }}</textarea>
            </div>
            <input type="hidden" name="mode" value="edit_data">
            <input type="hidden" name="meta_id" value="{{ meta.id }}">
            <button type="submit" class="btn btn-primary btn-sm">
              <i class="fa fa-check mr-2"></i>Update
            </button>
          </form>
        </div>
      </div>
      {% empty %}
      <div class="p-12 text-center">
        <div class="w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mx-auto mb-4">
          <i class="fa fa-tags text-2xl text-neutral-400"></i>
        </div>
        <p class="text-neutral-500">No meta data found</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock stage %}

{% block script %}
<script type="text/javascript">
$(document).ready(function(event) {
  $('.edit-btn').click(function(e) {
    $(this).closest('.p-4').find('.edit_panel').slideToggle('slow');
  });

  $('#new_meta').click(function(e) {
    if ($(this).text().trim() == 'Add Meta') {
      $(this).html('<i class="fa fa-times mr-2"></i>Cancel');
    } else {
      $(this).html('<i class="fa fa-plus mr-2"></i>Add Meta');
    }
    $('.add_panel').slideToggle('slow');
  });
});

$('form#addform').ajaxForm({
  type: 'POST',
  dataType: 'json',
  url: ".",
  data: $("#addform").serialize(),
  success: function(data) {
    if (data.error == false) {
      open_dialog_with_url('Meta Data Included Successfully', 'Success!!!', "{{ request.get_full_path }}")
    } else {
      $('p.error').remove()
      for (var key in data.response) {
        $('#'+key).after('<p class="text-red-500 text-sm mt-1">' + data.response[key] + '</p>')
      }
    }
  }
});

$('form.editform').ajaxForm({
  type: 'POST',
  dataType: 'json',
  url: ".",
  success: function(data) {
    if (data.error == false) {
      open_dialog_with_url(data.response, 'Success!!!', "{{ request.get_full_path }}")
    } else if (data.message) {
      open_dialog_with_url(data.response, 'Success!!!', "{{ request.get_full_path }}")
    } else {
      for (var key in data.response) {
        open_dialog(key + ' : ' + data.response[key], 'Error!')
      }
    }
  }
});

$(".delete_data").click(function(e) {
  e.preventDefault();
  id = $(this).attr('data-href')
  $('#block_question').text('Do you want to permanently remove this meta_data?')
  $('#block_question').dialog({
    modal: true,
    dialogClass: "no-close",
    draggable: false,
    title: "Info!!",
    buttons: [
      {
        text: "Yes",
        click: function() {
          $(this).dialog("close");
          $.post('.', {'mode': 'delete_data', 'meta_id': id}, function(data) {
            if (data.error) {
              open_dialog(data.response, 'Error!')
            } else {
              open_dialog_with_url(data.response, 'Success!!!', "{{ request.get_full_path }}")
            }
          }, 'json');
        }
      },
      {
        text: "No",
        click: function() {
          $(this).dialog("close");
        }
      }
    ]
  });
});
</script>
{% endblock script %}
