{% extends "dashboard/base.html" %}
{% load page_tags %}
{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a href="{% url 'dashboard:view_company' company.id %}" class="inline-flex items-center justify-center w-10 h-10 rounded-lg bg-neutral-100 text-neutral-600 hover:bg-neutral-200 transition-colors">
        <i class="fa fa-arrow-left"></i>
      </a>
      <div>
        <h1 class="text-2xl font-semibold text-neutral-900">{{ company.name }} - Job Posts</h1>
        <p class="text-sm text-neutral-500 mt-0.5">Manage job posts for this company</p>
      </div>
    </div>
  </div>

  <!-- Job Posts Table -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full" id="sample_1">
        <thead>
          <tr class="bg-neutral-50 border-b border-neutral-200">
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Job Code</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Job Title</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Location</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Status</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Posted By</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Posted On</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Applied</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-neutral-100">
          {% for post in job_posts %}
          <tr data-href='/dashboard/jobpost/view/{{ post.id }}/' class='job_detail hover:bg-neutral-50 cursor-pointer transition-colors'>
            <td class="px-4 py-3">
              <span class="text-sm font-medium text-primary-600">{{ post.code }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-900">{{ post.title }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">
                {% for location in post.location.all %}{% if forloop.last %}{{ location.name }}{% else %}{{ location.name }}, {% endif %}{% endfor %}
              </span>
            </td>
            <td class="px-4 py-3">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                {% if post.status == 'Live' %}bg-green-100 text-green-800
                {% elif post.status == 'Published' %}bg-blue-100 text-blue-800
                {% elif post.status == 'Pending' %}bg-yellow-100 text-yellow-800
                {% elif post.status == 'Disabled' %}bg-red-100 text-red-800
                {% else %}bg-neutral-100 text-neutral-800{% endif %}">
                {{ post.status }}
              </span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ post.user.email }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ post.published_on|date:"M. d, Y" }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="inline-flex items-center justify-center min-w-[28px] h-7 px-2 rounded-full bg-primary-100 text-primary-700 text-sm font-medium">
                {{ post.get_all_applied_users_count }}
              </span>
            </td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-2">
                {% if post.job_type == 'government' %}
                <a href="{% url 'dashboard:edit_govt_job' post.id %}" id="{{ post.id }}" class="edit-job p-1.5 rounded-md hover:bg-neutral-100 text-blue-600 transition-colors" title="Edit Job">
                  <i class="fa fa-edit"></i>
                </a>
                {% endif %}

                {% if post.status == 'Disabled' %}
                <a href="#" id="{{ post.id }}" class="enable-job p-1.5 rounded-md hover:bg-green-100 text-green-600 transition-colors" title="Enable Job">
                  <i class="fa fa-check"></i>
                </a>
                {% else %}
                <a href="#" id="{{ post.id }}" class="deactivate-job p-1.5 rounded-md hover:bg-red-100 text-red-600 transition-colors" title="Deactivate Job">
                  <i class="fa fa-times"></i>
                </a>
                {% endif %}

                {% if post.status == 'Pending' %}
                <a href="{% url 'dashboard:publish' post.id %}" id="{{ post.id }}" class="pending-job p-1.5 rounded-md hover:bg-yellow-100 text-yellow-600 transition-colors" title="Pending">
                  <i class="fa fa-hand-o-up"></i>
                </a>
                {% elif post.status == 'Published' %}
                <a href="{% url 'dashboard:publish' post.id %}" id="{{ post.id }}" class="publish-job p-1.5 rounded-md hover:bg-blue-100 text-blue-600 transition-colors" title="Published">
                  <i class="fa fa-check"></i>
                </a>
                {% elif post.status == 'Live' %}
                <a href="#" id="{{ post.id }}" class="live-job p-1.5 rounded-md hover:bg-green-100 text-green-600 transition-colors" title="Live">
                  <i class="fa fa-check"></i>
                </a>
                {% else %}
                <a href="#" id="{{ post.id }}" class="draft-job p-1.5 rounded-md hover:bg-neutral-100 text-neutral-600 transition-colors" title="Draft">
                  <i class="fa fa-check"></i>
                </a>
                {% endif %}

                <a href="#" id="{{ post.id }}" class="delete-job p-1.5 rounded-md hover:bg-red-100 text-red-600 transition-colors" title="Delete Job">
                  <i class="fa fa-trash-o"></i>
                </a>

                {% if post.status == 'Live' %}
                <a href="{{ post.slug }}" target="_blank" class="p-1.5 rounded-md hover:bg-neutral-100 text-neutral-600 transition-colors" title="View Job">
                  <i class="fa fa-eye"></i>
                </a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center">
                <div class="w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mb-4">
                  <i class="fa fa-briefcase text-2xl text-neutral-400"></i>
                </div>
                <p class="text-neutral-500">No job posts found for this company</p>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  {% get_page current_page last_page as pages %}
  {% if last_page > 1 %}
  <div class="flex justify-center">
    <nav class="inline-flex items-center gap-1" aria-label="Pagination">
      {% if current_page != 1 %}
      <a href="?{% if search_value %}search={{ search_value }}&{% endif %}page={{ previous_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-double-left"></i>
      </a>
      <a href="?{% if search_value %}search={{ search_value }}&{% endif %}page={{ prev_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-left"></i>
      </a>
      <a href="?{% if search_value %}search={{ search_value }}&{% endif %}page=1" class="inline-flex items-center justify-center px-3 h-9 rounded-lg border border-neutral-200 bg-white text-sm text-neutral-600 hover:bg-neutral-50 transition-colors">
        first
      </a>
      {% endif %}
      {% for s in pages %}
      <a href="?{% if search_value %}search={{ search_value }}&{% endif %}page={{ s }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border text-sm font-medium transition-colors {% if s == current_page %}border-primary-500 bg-primary-500 text-white{% else %}border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50{% endif %}">
        {{ s }}
      </a>
      {% endfor %}
      {% if current_page != last_page %}
      <a href="?{% if search_value %}search={{ search_value }}&{% endif %}page={{ last_page }}" class="inline-flex items-center justify-center px-3 h-9 rounded-lg border border-neutral-200 bg-white text-sm text-neutral-600 hover:bg-neutral-50 transition-colors">
        last
      </a>
      <a href="?{% if search_value %}search={{ search_value }}&{% endif %}page={{ aft_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-right"></i>
      </a>
      <a href="?{% if search_value %}search={{ search_value }}&{% endif %}page={{ after_page }}" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50 transition-colors">
        <i class="fa fa-angle-double-right"></i>
      </a>
      {% endif %}
    </nav>
  </div>
  {% endif %}
</div>
{% endblock stage %}

{% block script %}
<script type="text/javascript">
  $('.delete-job').click(function (e) {
    e.preventDefault();
    e.stopPropagation();
    url = $(this).attr('id') + '/'
    $('#block_question').text('Do you want to delete Jobpost?')
    $('#block_question').dialog({
      modal: true,
      dialogClass: "no-close",
      draggable: false,
      title: "Info!!",
      buttons: [
        {
          text: "Yes",
          click: function () {
            $(this).dialog("close");
            $.post('/dashboard/jobpost/delete/' + url, $("form#jobform").serialize(), function (data) {
              if (data.error) {
                open_dialog(data.response, 'Error!')
              } else {
                open_dialog_with_url('Job Post Deleted Successfully', 'Success!!!', ".")
              }
            }, 'json');
          }
        },
        {
          text: "No",
          click: function () {
            $(this).dialog("close");
          }
        }
      ]
    });
  });

  $('.deactivate-job').click(function (e) {
    e.preventDefault();
    e.stopPropagation();
    url = $(this).attr('id') + '/'
    $('#block_question').text('Do you want to deactivate Jobpost?')
    $('#block_question').dialog({
      modal: true,
      dialogClass: "no-close",
      draggable: false,
      title: "Info!!",
      buttons: [
        {
          text: "Yes",
          click: function () {
            $(this).dialog("close");
            $.post('/dashboard/jobpost/deactivate/' + url, $("form#jobform").serialize(), function (data) {
              if (data.error) {
                open_dialog(data.response, 'Error!')
              } else {
                open_dialog_with_url('Job Post Disabled Successfully', 'Success!!!', ".")
              }
            }, 'json');
          }
        },
        {
          text: "No",
          click: function () {
            $(this).dialog("close");
          }
        }
      ]
    });
  });

  $('.enable-job').click(function (e) {
    e.preventDefault();
    e.stopPropagation();
    url = $(this).attr('id') + '/'
    $('#block_question').text('Do you want to enable JobPost?')
    $('#block_question').dialog({
      modal: true,
      dialogClass: "no-close",
      draggable: false,
      title: "Info!!",
      buttons: [
        {
          text: "Yes",
          click: function () {
            $(this).dialog("close");
            $.post('/dashboard/jobpost/enable/' + url, {}, function (data) {
              if (data.error) {
                open_dialog(dat.response, 'Error!')
              } else {
                open_dialog_with_url('Job Post Enabled Successfully', 'Success!!!', ".")
              }
            }, 'json');
          }
        },
        {
          text: "No",
          click: function () {
            $(this).dialog("close");
          }
        }
      ]
    });
  });

  $('#sample_1').DataTable({
    "sPaginationType": "full_numbers",
    "aaSorting": [],
    "bSort": true,
    "aLengthMenu": [[20, 50, 75, -1], [20, 50, 75, "All"]],
    "pageLength": 20,
  });

  $(".job_detail").click(function () {
    window.document.location = $(this).data("href");
  });
</script>
{% endblock script %}
