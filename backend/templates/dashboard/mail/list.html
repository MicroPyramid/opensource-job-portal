{% extends 'dashboard/base.html' %}
{% load tz %}
{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-neutral-900">Email Templates</h1>
      <p class="text-sm text-neutral-500 mt-0.5">Manage your email templates</p>
    </div>
    <a href="{% url 'dashboard:new_template' %}" class="btn btn-primary">
      <i class="fa fa-plus mr-2"></i>Add New Template
    </a>
  </div>

  <!-- Templates Table -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full" id="sample_1">
        <thead>
          <tr class="bg-neutral-50 border-b border-neutral-200">
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider w-12">#</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Title</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Subject</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Created On</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Modified On</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-neutral-100">
          {% for mailtemplate in mailtemplates %}
          <tr class="hover:bg-neutral-50 transition-colors">
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-500">{{ forloop.counter }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm font-medium text-neutral-900">{{ mailtemplate.title }}</span>
            </td>
            <td class="px-4 py-3">
              <a href="{% url 'dashboard:view_mailtemplate' mailtemplate.id %}" class="text-sm text-primary-600 hover:text-primary-700">
                {{ mailtemplate.subject }}
              </a>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ mailtemplate.created_on|timezone:'Asia/Calcutta' }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ mailtemplate.modified_on|timezone:'Asia/Calcutta' }}</span>
            </td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-2">
                <a href="{% url 'dashboard:edit_mailtemplate' mailtemplate.id %}" id="{{ mailtemplate.id }}" class="edit-mailtemplate p-1.5 rounded-md hover:bg-blue-100 text-blue-600 transition-colors" title="Edit">
                  <i class="fa fa-edit"></i>
                </a>
                <a href="#" id="{{ mailtemplate.id }}" class="delete-mailtemplate p-1.5 rounded-md hover:bg-red-100 text-red-600 transition-colors" title="Delete">
                  <i class="fa fa-times"></i>
                </a>
                <a href="{% url 'dashboard:send_mail' mailtemplate.id %}" id="{{ mailtemplate.id }}" class="send-mail p-1.5 rounded-md hover:bg-green-100 text-green-600 transition-colors" title="Send Mail">
                  <i class="fa fa-envelope"></i>
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center">
                <div class="w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mb-4">
                  <i class="fa fa-envelope text-2xl text-neutral-400"></i>
                </div>
                <p class="text-neutral-500">No email templates found</p>
                <a href="{% url 'dashboard:new_template' %}" class="mt-4 text-primary-600 hover:text-primary-700 text-sm font-medium">
                  Create your first template
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock stage %}

{% block script %}
<script type="text/javascript">
  $('#sample_1').DataTable({
    "sPaginationType": "full_numbers",
    "aaSorting": [],
    "bSort": true,
    "aLengthMenu": [[20, 50, 75, -1], [20, 50, 75, "All"]],
    "pageLength": 20,
  });

  $('.delete-mailtemplate').click(function (e) {
    e.preventDefault();
    url = $(this).attr('id') + '/'
    $('#block_question').text('Do you want to delete Template?')
    $('#block_question').dialog({
      modal: true,
      dialogClass: "no-close",
      draggable: false,
      title: "Info!!",
      buttons: [
        {
          text: "Yes",
          click: function () {
            $(this).dialog("close");
            $.post('/dashboard/mail-template/delete/' + url, $("form#jobform").serialize(), function (data) {
              if (data.error) {
                open_dialog(data.response, 'Error!')
              } else {
                open_dialog_with_url('Email Template Deleted Successfully', 'Success!!!', "{% url 'dashboard:emailtemplates' %}")
              }
            }, 'json');
          }
        },
        {
          text: "No",
          click: function () {
            $(this).dialog("close");
          }
        }
      ]
    });
  });
</script>
{% endblock script %}
