{% extends 'dashboard/base.html' %}
{% load tz %}
{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-neutral-900">Sent Emails</h1>
      <p class="text-sm text-neutral-500 mt-0.5">View all sent emails</p>
    </div>
    <a href="{% url 'dashboard:new_template' %}" class="btn btn-primary">
      <i class="fa fa-plus mr-2"></i>Add New Template
    </a>
  </div>

  <!-- Sent Mails Table -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full" id="sample_1">
        <thead>
          <tr class="bg-neutral-50 border-b border-neutral-200">
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider w-12">#</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Subject</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Title</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Sent On</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-neutral-600 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-neutral-100">
          {% for sent_mail in sent_mails %}
          <tr class="hover:bg-neutral-50 transition-colors">
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-500">{{ forloop.counter }}</span>
            </td>
            <td class="px-4 py-3">
              <a href="{% url 'dashboard:view_sent_mail' sent_mail.id %}" class="text-sm text-primary-600 hover:text-primary-700 font-medium">
                {{ sent_mail.template.subject }}
              </a>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ sent_mail.template.title }}</span>
            </td>
            <td class="px-4 py-3">
              <span class="text-sm text-neutral-600">{{ sent_mail.send_on|timezone:'Asia/Calcutta' }}</span>
            </td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-2">
                <a href="#" id="{{ sent_mail.id }}" class="delete-mailtemplate p-1.5 rounded-md hover:bg-red-100 text-red-600 transition-colors" title="Delete">
                  <i class="fa fa-times"></i>
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center">
                <div class="w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mb-4">
                  <i class="fa fa-paper-plane text-2xl text-neutral-400"></i>
                </div>
                <p class="text-neutral-500">No sent emails found</p>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock stage %}

{% block script %}
<script type="text/javascript">
  $('#sample_1').DataTable({
    "sPaginationType": "full_numbers",
    "aaSorting": [],
    "bSort": true,
    "aLengthMenu": [[20, 50, 75, -1], [20, 50, 75, "All"]],
    "pageLength": 20,
  });

  $('.delete-mailtemplate').click(function (e) {
    e.preventDefault();
    var mailId = $(this).attr('id');
    $('#block_question').text('Do you want to delete Sent Mail?')
    $('#block_question').dialog({
      modal: true,
      dialogClass: "no-close",
      draggable: false,
      title: "Info!!",
      buttons: [
        {
          text: "Yes",
          click: function () {
            $.post('/dashboard/sent-mail/delete/' + mailId + '/', $("form#jobform").serialize(), function (data) {
              if (data.error) {
                open_dialog(data.response, 'Error!')
              } else {
                open_dialog_with_url("Sent mail Deleted Successfully", 'Success!!!', "{% url 'dashboard:sent_mails' %}")
              }
            }, 'json');
            $(this).dialog("close");
          }
        },
        {
          text: "No",
          click: function () {
            $(this).dialog("close");
            return;
          }
        }
      ]
    });
  });
</script>
{% endblock script %}
