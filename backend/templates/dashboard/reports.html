{% extends 'dashboard/base.html' %}
{% block stage %}
<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-neutral-900">Mobile Campaign</h1>
      <p class="text-sm text-neutral-500 mt-0.5">View campaign reports and analytics</p>
    </div>
  </div>

  <!-- Search Filters -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h3 class="text-lg font-semibold text-neutral-800">
        <i class="fa fa-filter text-primary-500 mr-2"></i>Filter Reports
      </h3>
    </div>
    <div class="p-6">
      <form id="search_form" name="adv-search-form" method="POST" action=".">
        <input type="hidden" name="job_type" id="job_type" value="{{ job_type }}"/>
        <input type="hidden" name="page" id="page" value="{{ page }}"/>
        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
          <div class="md:col-span-3">
            <label class="block text-sm font-medium text-neutral-700 mb-2">Date Range</label>
            <input type="text" class="form-control" id="reportrange" name="timestamp" value="{{request.POST.timestamp}}" placeholder="Select the date">
          </div>
          <div class="md:col-span-6">
            <label class="block text-sm font-medium text-neutral-700 mb-2">Skills</label>
            <select name='skills' id='skills' class='form-control select2' multiple>
              <option value=''>Select A Skill</option>
              {% for skill in all_skills %}
                <option value="{{ skill.id }}" {% if skill.id|slugify in selected_skills %}selected {% endif %}>{{ skill }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="md:col-span-3">
            <button type="submit" class="btn btn-primary w-full">
              <i class="fa fa-search mr-2"></i>Submit
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Hidden Data Elements -->
  <div id="location" class="hidden">{{ location|safe }}</div>
  <div id="jobs_location" class="hidden">{{ jobs_location|safe }}</div>
  <div id="active_recruiters" class="hidden">{{ active_recruiters|safe }}</div>
  <div id="inactive_recruiters" class="hidden">{{ inactive_recruiters|safe }}</div>
  <div id="job_posts" class="hidden">{{ job_posts|safe }}</div>
  <div id="skills_names" class="hidden">{{ skills_names|safe }}</div>
  <div id="skill_wise_jobs_count" class="hidden">{{ skill_wise_jobs_count|safe }}</div>

  {% if location|length > 1 %}
  <!-- Recruiters Chart -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h3 class="text-lg font-semibold text-neutral-800">
        <i class="fa fa-users text-primary-500 mr-2"></i>Recruiters by Location
      </h3>
    </div>
    <div class="p-6">
      <div id="myChart" class="w-full" style="height: 400px;"></div>
    </div>
  </div>

  <!-- Job Posts Chart -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h3 class="text-lg font-semibold text-neutral-800">
        <i class="fa fa-briefcase text-primary-500 mr-2"></i>Job Posts by Location
      </h3>
    </div>
    <div class="p-6">
      <div id="jobpostchart" class="w-full" style="height: 400px;"></div>
    </div>
  </div>
  {% endif %}

  {% if skills_names|length > 0 %}
  <!-- Skills Chart -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-neutral-200">
      <h3 class="text-lg font-semibold text-neutral-800">
        <i class="fa fa-code text-primary-500 mr-2"></i>Jobs by Skills
      </h3>
    </div>
    <div class="p-6">
      <div id="skillschart" class="w-full" style="height: 400px;"></div>
    </div>
  </div>
  {% endif %}

  {% if location|length <= 1 and skills_names|length == 0 %}
  <!-- Empty State -->
  <div class="bg-white rounded-xl border border-neutral-200 shadow-sm overflow-hidden">
    <div class="p-12 text-center">
      <div class="w-16 h-16 rounded-full bg-neutral-100 flex items-center justify-center mx-auto mb-4">
        <i class="fa fa-chart-line text-2xl text-neutral-400"></i>
      </div>
      <p class="text-neutral-500">No data available for the selected filters</p>
      <p class="text-sm text-neutral-400 mt-1">Try adjusting your date range or skill selection</p>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block script %}
<script>
  $('.select2').select2({placeholder:'Select A Skill'});

  {% if location|length > 1 %}
  var trace1 = {
    x: JSON.parse($('#location').html()),
    y: JSON.parse($('#active_recruiters').html()),
    mode: 'lines',
    name: 'Active Recruiters',
    line: { color: '#10b981' }
  };

  var trace2 = {
    x: JSON.parse($('#location').html()),
    y: JSON.parse($('#inactive_recruiters').html()),
    mode: 'lines',
    name: 'Inactive Recruiters',
    line: { color: '#ef4444' }
  };

  var recruiter_data = [trace1, trace2];

  var jobposts_data = {
    x: JSON.parse($('#jobs_location').html()),
    y: JSON.parse($('#job_posts').html()),
    mode: 'lines',
    name: 'Job Posts',
    line: { color: '#6366f1' }
  };

  var jobposts = [jobposts_data];

  var recruiter_layout = {
    title: 'Number of Recruiters',
    autosize: true,
    margin: { t: 50, l: 50, r: 30, b: 50 }
  };

  var jobpost_layout = {
    title: 'Number of Job Posts',
    autosize: true,
    margin: { t: 50, l: 50, r: 30, b: 50 }
  };

  Plotly.newPlot('myChart', recruiter_data, recruiter_layout, {
    displaylogo: false,
    displayModeBar: false,
    responsive: true
  });

  Plotly.newPlot('jobpostchart', jobposts, jobpost_layout, {
    displaylogo: false,
    displayModeBar: false,
    responsive: true
  });
  {% endif %}

  {% if skills_names|length > 0 %}
  var skills_data = {
    x: JSON.parse($('#skills_names').html()),
    y: JSON.parse($('#skill_wise_jobs_count').html()),
    mode: 'lines',
    name: 'Skills',
    line: { color: '#f59e0b' }
  };

  var skills = [skills_data];

  var skill_layout = {
    title: 'Jobs by Skills',
    autosize: true,
    margin: { t: 50, l: 50, r: 30, b: 50 }
  };

  Plotly.newPlot('skillschart', skills, skill_layout, {
    displaylogo: false,
    displayModeBar: false,
    responsive: true
  });
  {% endif %}
</script>
{% endblock script %}
